
@{
    ViewData["Title"] = "Index";
}

<div class="auth-wrapper" id="Login">
    <div class="auth-content">
        <div class="auth-bg">
            <span class="r"></span>
            <span class="r s"></span>
            <span class="r s"></span>
            <span class="r"></span>
        </div>
        <div class="card">
            <div class="card-body text-center">
                <div class="mb-4">
                    <i class="feather icon-unlock auth-icon"></i>
                </div>
                <div v-if="loading === true">
                    loading ... 
                </div>
                <div v-if="loading === false">
                    <h3 class="mb-4">Administrador Ecommerce</h3>
                    <div class="alert alert-warning alert-dismissible fade show" role="alert" v-if="Error.Error === true">
                        <strong>Error!</strong> {{ Error.Description }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="alert alert-success alert-dismissible fade show" role="alert" v-if="loginSuccess === true">
                        <strong>Success!</strong> Usuario y contraseña correctas
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form action="/" method="post" v-on:submit.prevent="doLogin">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" v-model="userData.User" placeholder="Usuario" required>
                        </div>
                        <div class="input-group mb-4">
                            <input type="password" class="form-control" v-model="userData.Contrasena" placeholder="Contraseña" required>
                        </div>
                        <button type="submit" class="btn btn-primary shadow-2 mb-4">Entrar</button>
                    </form>
                </div>
               

            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        var router = new VueRouter({mode: "history"}) ;
        var app = new Vue({
            el: '#Login',
            data: {
                userData: {
                    User: "",
                    Contrasena: ""
                },
                Error: {
                    Error: false,
                    Description: ""
                },
                loginSuccess: false,
                loading: false
            },
            methods: {
                doLogin: function (evt) {
                    this.loading = true;
                    evt.preventDefault();
                    axios.post('./Login/Create', this.userData).then(response => {
                        console.log(response.data);
                        this.Error.Error = response.data.error;
                        this.Error.Description = response.data.description;
                        if (response.data.error == false) {
                            this.loginSuccess = true;
                            //router.go('');
                            window.location = '../Home';
                        } else {
                            this.loginSuccess = false;
                        }
                    }).catch(error => {
                        console.log(error)
                        this.Error.Error = true;
                        this.loginSuccess = false;
                        this.Error.Description = error.message;
                    }).finally(() => this.loading = false)
                }
            }
        })
    </script>
}

